<div class="flex flex-col">
  <label
    *ngIf="!noLabel"
    class="mb-dl-1 ml-dl-1 text-dl-5 font-dl-3 text-dl-tan-3 dark:text-dl-tan-8"
    >{{ label }}</label
  >
  <div class="relative flex w-full flex-col items-center">
    <div
      (click)="toggleDropdown()"
      id="expanded"
      class="relative min-h-dl-5 w-full cursor-pointer rounded-md border-0 px-dl-4 py-dl-4 text-dl-6 text-dl-tan-1 outline-none ring-2 ring-inset focus:ring-2 focus:ring-inset focus:ring-dl-green-5 dark:text-dl-tan-9"
      [ngClass]="{
        'rounded-b-none bg-dl-tan-10 shadow-md shadow-dl-green-5/20 ring-dl-green-5 dark:bg-dl-tan-3  ':
          isOpen(),
        'rounded-b-md bg-dl-tan-10 ring-dl-tan-8 dark:bg-dl-tan-2 dark:ring-dl-tan-1':
          !isOpen()
      }"
    >
      <svg
        *ngIf="!value"
        style="pointer-events: none"
        class="z-15 absolute right-5 top-1/2 -translate-y-1/2 rotate-90 transform"
        version="1.1"
        height="15"
        width="15"
        viewBox="0 -15 100 125"
      >
        <path
          [attr.fill]="this.extraStuffService.getFillColor(10)"
          d="M51,49.9L24.4,23.4c-4.2-4.2-4.2-11,0-15.2c4.2-4.2,11-4.2,15.3,0l37.3,37.2c2.5,2.5,2.5,6.6,0,9.2L39.6,91.7  c-4.2,4.2-11,4.2-15.3,0c-4.2-4.2-4.2-11,0-15.2L51,49.9z"
        />
      </svg>
      {{ getDisplayText() }}
    </div>
    <div
      *ngIf="isOpen()"
      class="absolute top-10 z-20 max-h-dl-12 w-full overflow-y-auto rounded-b-md border-2 border-t-0 border-dl-green-5 bg-dl-tan-10 shadow-lg dark:bg-dl-tan-2"
    >
      <div class="z-25 sticky top-0 bg-dl-tan-10 dark:bg-dl-tan-2">
        <div class="relative">
          <svg
            width="28"
            height="28"
            viewBox="0 0 15 15"
            class="absolute top-2 text-dl-tan-3 dark:text-dl-tan-8"
            fill="none"
          >
            <path
              d="M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z"
              fill="currentColor"
              fill-rule="evenodd"
              clip-rule="evenodd"
            ></path>
          </svg>
          <input
            #inputField
            type="text"
            class="border-y-1 w-full rounded-b-none border-x-0 border-dl-green-5 bg-dl-tan-10 py-dl-3 pl-dl-7 pr-dl-4 text-dl-6 font-dl-3 text-dl-tan-4 ring-transparent focus:border-dl-green-4 focus:ring-transparent dark:bg-dl-tan-3 dark:text-dl-tan-8 focus:dark:border-dl-green-7"
            (input)="onFilterChange($event)"
          />
        </div>
      </div>
      <div
        *ngIf="additionalOptionName"
        (click)="selectOption({ value: 'new', display: additionalOptionName })"
        class="hover:dark:text-dl-tan- cursor-pointer px-dl-4 py-dl-3 text-dl-6 font-dl-3 text-dl-tan-4 hover:bg-dl-green-10 hover:text-dl-tan-3 dark:text-dl-tan-8 dark:hover:bg-dl-green-2 dark:hover:text-dl-tan-9"
      >
        {{ additionalOptionName }}
      </div>
      <div
        *ngFor="let option of sortedOptions"
        (click)="selectOption(option)"
        class="hover:dark:text-dl-tan- cursor-pointer px-dl-4 py-dl-3 text-dl-6 font-dl-3 text-dl-tan-4 hover:bg-dl-green-10 hover:text-dl-tan-3 dark:text-dl-tan-8 dark:hover:bg-dl-green-2 dark:hover:text-dl-tan-9"
      >
        {{ option.display }}
      </div>
    </div>
    <div
      [ngClass]="{
        invisible: !hasError
      }"
      class="my-dl-1 text-dl-5 font-dl-2 text-dl-red-5 dark:text-dl-red-8"
    >
      <ng-container>
        <div>{{ errorMessage || "NA" }}</div>
      </ng-container>
    </div>
  </div>
</div>
