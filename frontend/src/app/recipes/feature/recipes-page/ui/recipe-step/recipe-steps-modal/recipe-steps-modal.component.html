<div
  class="relative max-h-dl-22 w-full transform overflow-y-auto bg-white px-dl-5 pb-dl-4 pt-dl-4 text-left transition-all dark:border-dl-grey-4 dark:bg-dl-grey-1"
>
  <mat-spinner
    class="my-app-custom-spinner"
    *ngIf="isAdding$ | async"
  ></mat-spinner>
  <div *ngIf="!(isAdding$ | async)" class="mt-dl-1 text-center">
    <div class="mb-dl-4 text-center">
      <p
        class="leading-dl-4 text-dl-6 font-dl-3 text-dl-grey-4 dark:text-dl-grey-7"
      >
        Steps
      </p>
    </div>

    <!--List of Recipe Steps-->
    <div class="mx-dl-2 mb-dl-5 flex flex-col">
      <div
        cdkDropList
        (cdkDropListDropped)="onDrop($event)"
        class="mb-dl-2 flex w-dl-15 flex-col items-start"
      >
        <ng-container
          *ngFor="let step of displayRecipeSteps$ | async; let i = index"
        >
          <div
            cdkDrag
            class="relative inline-block"
            (click)="toggleItemMenu($event, i)"
          >
            <div
              class="mt-dl-3 flex flex-wrap items-center justify-center rounded-dl-1 bg-dl-grey-10 px-dl-3 py-dl-2 text-dl-5 text-dl-grey-4 dark:bg-dl-grey-2 dark:text-dl-grey-7"
              [ngClass]="{ 'bg-dl-grey-9': modalActiveForRowID === i }"
            >
              <span class="font-dl-3"
                >{{ step.sequence }}:&nbsp;{{
                  step.title
                }}&nbsp;&nbsp;&nbsp;</span
              >
              <span
                *ngIf="step.toAdd"
                class="text-dl-5 font-dl-2 italic text-dl-grey-5 dark:text-dl-grey-6"
                >&nbsp;&nbsp;&nbsp;adding&nbsp;&nbsp;</span
              >
              <span
                *ngIf="step.toUpdate"
                class="text-dl-5 font-dl-2 italic text-dl-grey-5 dark:text-dl-grey-6"
                >&nbsp;&nbsp;&nbsp;updating&nbsp;&nbsp;</span
              >
              <span
                *ngIf="step.sequenceChanged"
                class="font-dl-2 italic text-dl-grey-5 dark:text-dl-grey-6"
                >&nbsp;&nbsp;&nbsp;moving</span
              >
              <svg
                class="ml-dl-2"
                width="32"
                height="32"
                viewBox="0 -2 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M3.625 7.5C3.625 8.12132 3.12132 8.625 2.5 8.625C1.87868 8.625 1.375 8.12132 1.375 7.5C1.375 6.87868 1.87868 6.375 2.5 6.375C3.12132 6.375 3.625 6.87868 3.625 7.5ZM8.625 7.5C8.625 8.12132 8.12132 8.625 7.5 8.625C6.87868 8.625 6.375 8.12132 6.375 7.5C6.375 6.87868 6.87868 6.375 7.5 6.375C8.12132 6.375 8.625 6.87868 8.625 7.5ZM12.5 8.625C13.1213 8.625 13.625 8.12132 13.625 7.5C13.625 6.87868 13.1213 6.375 12.5 6.375C11.8787 6.375 11.375 6.87868 11.375 7.5C11.375 8.12132 11.8787 8.625 12.5 8.625Z"
                  fill="currentColor"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div
              #itemMenu
              *ngIf="itemMenuOpen.open && itemMenuOpen.index === i"
              class="focus:outling-none absolute right-2 top-2 z-10 flex flex-col bg-white shadow-md ring-1 ring-dl-grey-1 ring-opacity-5 ease-out dark:bg-dl-grey-1"
            >
              <button
                (click)="onUpdateClick(step, i)"
                type="button"
                class="block cursor-pointer px-dl-3 py-dl-2 text-dl-5 text-dl-grey-3 hover:bg-dl-grey-10 dark:text-dl-grey-8 dark:hover:bg-dl-grey-2"
              >
                Edit
              </button>
              <button
                (click)="onDeleteClick(step, i)"
                type="button"
                class="block cursor-pointer px-dl-3 py-dl-2 text-dl-5 text-dl-grey-3 hover:bg-dl-grey-10 dark:text-dl-grey-8 dark:hover:bg-dl-grey-2"
              >
                Delete
              </button>
            </div>
          </div>
        </ng-container>
      </div>
      <button
        type="button"
        class="relative mt-dl-2 flex h-dl-4 w-dl-4 items-center justify-center rounded-dl-1 bg-dl-grey-10 text-dl-2 transition-all duration-150 hover:bg-dl-grey-9 focus:outline-none focus:ring-2 focus:ring-dl-grey-7 dark:bg-dl-grey-2 hover:dark:bg-dl-grey-3"
        (click)="onAddClick()"
        id="addRecipeStepButton"
      >
        <span class="sr-only">Add Recipe Step</span>
        <svg
          class="text-dl-grey-2"
          width="22"
          height="22"
          viewBox="0 0 15 15"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8 2.75C8 2.47386 7.77614 2.25 7.5 2.25C7.22386 2.25 7 2.47386 7 2.75V7H2.75C2.47386 7 2.25 7.22386 2.25 7.5C2.25 7.77614 2.47386 8 2.75 8H7V12.25C7 12.5261 7.22386 12.75 7.5 12.75C7.77614 12.75 8 12.5261 8 12.25V8H12.25C12.5261 8 12.75 7.77614 12.75 7.5C12.75 7.22386 12.5261 7 12.25 7H8V2.75Z"
            fill="currentColor"
            fill-rule="evenodd"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Cancel, Submit Buttons-->
    <div class="sm:mt-dl-4 sm:flex sm:flex-row-reverse mt-dl-3">
      <button
        type="button"
        class="shadow-s sm:ml-dl-4 h-dl-5 w-full justify-center rounded-dl-1 px-dl-1 py-dl-1 text-dl-5 font-dl-3 text-white dark:text-dl-grey-1"
        [ngClass]="{
          'cursor-pointer bg-dl-pink-4  dark:bg-dl-pink-7':
            stepsToAdd === true ||
            stepsToReorder === true ||
            stepsToUpdate === true,
          'bg-dl-grey-7':
            stepsToAdd === false &&
            stepsToReorder === false &&
            stepsToUpdate === false
        }"
        [disabled]="
          stepsToAdd === false &&
          stepsToReorder === false &&
          stepsToUpdate === false
        "
        (click)="onSubmit()"
      >
        Submit Changes
      </button>
      <button
        type="button"
        class="sm:mt-0 sm:w-auto mt-dl-3 h-dl-5 w-full justify-center rounded-dl-1 bg-white px-dl-1 py-dl-1 text-dl-5 font-dl-3 text-dl-grey-2 shadow-sm ring-1 ring-inset ring-dl-grey-7 hover:bg-dl-grey-10 dark:bg-dl-grey-1 dark:text-dl-grey-9 dark:hover:bg-dl-grey-2"
        (click)="onCancel()"
      >
        Cancel
      </button>
    </div>
  </div>
</div>
