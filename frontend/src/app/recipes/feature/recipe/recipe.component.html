<div class="w-full">
  <div *ngIf="displayRecipe$ | async">
    <img
      *ngIf="(displayRecipe$ | async).photo"
      [src]="(displayRecipe$ | async).photo"
      alt="Recipe Image"
      class="w-full object-cover"
    />
    <!-- Overview -->
    <div class="relative mx-dl-5 rounded-lg shadow-md">
      <div class="mx-dl-5 mt-dl-4 flex justify-between">
        <h1 class="text-dl-8 font-dl-3 leading-dl-2 text-dl-grey-2">
          {{ (displayRecipe$ | async).title }}
        </h1>
        <svg
          class="mt-dl-4"
          width="35"
          height="35"
          viewBox="0 0 15 15"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          (click)="toggleMenu($event)"
        >
          <path
            d="M3.625 7.5C3.625 8.12132 3.12132 8.625 2.5 8.625C1.87868 8.625 1.375 8.12132 1.375 7.5C1.375 6.87868 1.87868 6.375 2.5 6.375C3.12132 6.375 3.625 6.87868 3.625 7.5ZM8.625 7.5C8.625 8.12132 8.12132 8.625 7.5 8.625C6.87868 8.625 6.375 8.12132 6.375 7.5C6.375 6.87868 6.87868 6.375 7.5 6.375C8.12132 6.375 8.625 6.87868 8.625 7.5ZM12.5 8.625C13.1213 8.625 13.625 8.12132 13.625 7.5C13.625 6.87868 13.1213 6.375 12.5 6.375C11.8787 6.375 11.375 6.87868 11.375 7.5C11.375 8.12132 11.8787 8.625 12.5 8.625Z"
            fill="currentColor"
            fill-rule="evenodd"
            clip-rule="evenodd"
          ></path>
        </svg>
        <div
          #menu
          *ngIf="menuOpen"
          class="focus:outling-none absolute right-16 top-2 z-10 flex flex-col bg-white shadow-md ring-1 ring-dl-grey-1 ring-opacity-5 ease-out"
        >
          <button
            (click)="onUpdateClick()"
            type="button"
            class="block cursor-pointer px-dl-3 py-dl-2 text-dl-5 text-dl-grey-3 hover:bg-dl-grey-10"
          >
            Edit
          </button>
          <button
            (click)="onDeleteClick()"
            type="button"
            class="block cursor-pointer px-dl-3 py-dl-2 text-dl-5 text-dl-grey-3 hover:bg-dl-grey-10"
          >
            Delete
          </button>
        </div>
      </div>
      <div class="mx-dl-5 mt-dl-1 flex justify-between">
        <div class="flex">
          <p class="ml-dl-4 text-dl-6 font-dl-2 leading-dl-2 text-dl-grey-6">
            {{ (recipeCategory$ | async)?.name }}
          </p>
        </div>
        <span class="ml-dl-6 text-dl-6 font-dl-3 text-dl-grey-6"
          >Servings: {{ (displayRecipe$ | async).servings }}</span
        >
      </div>
      <!--Times -->
      <div
        class="mx-dl-5 mt-dl-7 flex items-center justify-between px-dl-1 pb-dl-5 pt-dl-1"
      >
        <svg
          class="ml-dl-4 text-dl-grey-4"
          width="22"
          height="22"
          viewBox="0 0 15 15"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M7.50009 0.877014C3.84241 0.877014 0.877258 3.84216 0.877258 7.49984C0.877258 11.1575 3.8424 14.1227 7.50009 14.1227C11.1578 14.1227 14.1229 11.1575 14.1229 7.49984C14.1229 3.84216 11.1577 0.877014 7.50009 0.877014ZM1.82726 7.49984C1.82726 4.36683 4.36708 1.82701 7.50009 1.82701C10.6331 1.82701 13.1729 4.36683 13.1729 7.49984C13.1729 10.6328 10.6331 13.1727 7.50009 13.1727C4.36708 13.1727 1.82726 10.6328 1.82726 7.49984ZM8 4.50001C8 4.22387 7.77614 4.00001 7.5 4.00001C7.22386 4.00001 7 4.22387 7 4.50001V7.50001C7 7.63262 7.05268 7.7598 7.14645 7.85357L9.14645 9.85357C9.34171 10.0488 9.65829 10.0488 9.85355 9.85357C10.0488 9.65831 10.0488 9.34172 9.85355 9.14646L8 7.29291V4.50001Z"
            fill="currentColor"
            fill-rule="evenodd"
            clip-rule="evenodd"
          ></path>
        </svg>
        <p
          *ngIf="(displayRecipe$ | async).timePrep"
          class="text-dl-5 font-dl-2 text-dl-grey-4"
        >
          Prep: {{ timeString((displayRecipe$ | async).timePrep) }}
        </p>
        <p
          *ngIf="(displayRecipe$ | async).timeBake"
          class="text-dl-5 font-dl-2 text-dl-grey-4"
        >
          Bake: {{ timeString((displayRecipe$ | async).timeBake) }}
        </p>
        <p
          *ngIf="(displayRecipe$ | async).timeBake"
          class="text-dl-6 font-dl-3 text-dl-grey-3"
        >
          Total:
          {{
            timeString(
              (displayRecipe$ | async).timeBake +
                (displayRecipe$ | async).timePrep
            )
          }}
        </p>
      </div>
      <div
        class="mx-dl-4 flex items-center justify-between px-dl-1 pb-dl-5 pt-dl-1"
      >
        <div
          class="mx-dl-4 mb-dl-1 flex w-full items-center justify-between px-dl-1 pt-dl-1"
        >
          <p *ngIf=""></p>
          <div class="flex">
            <p class="text-dl-5 font-dl-2 text-dl-grey-4">Making it</p>
            <div
              style="position: relative"
              class="ml-dl-2 text-dl-5 font-dl-2 text-dl-blue-6"
            >
              <div (click)="picker.open()">
                {{ displayUsageDate }}
              </div>
              <input
                matInput
                [matDatepicker]="picker"
                [matDatepickerFilter]="filterPastDates"
                style="
                  position: absolute;
                  top: 0;
                  left: 0;
                  opacity: 0;
                  pointer-events: none;
                "
                (dateChange)="updateUsageDate($event)"
              />
              <mat-datepicker #picker></mat-datepicker>
            </div>
          </div>
          <button
            *ngIf="
              shoppingList?.ingredients?.length === 0 &&
              displayUsageDate === 'Today'
            "
            type="button"
            class="mr-dl-1 block w-dl-8 whitespace-nowrap rounded-dl-1 border bg-dl-pink-4 px-dl-1 py-dl-1 text-center text-dl-4 font-dl-3 text-white shadow-sm transition-all duration-200 ease-in-out hover:bg-dl-grey-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dl-pink-6"
            (click)="makeRecipe()"
          >
            Make it Now
          </button>
          <button
            *ngIf="
              shoppingList?.ingredients?.length !== 0"
            type="button"
            class="mr-dl-1 block w-dl-10 whitespace-nowrap rounded-dl-1 border bg-dl-pink-4 px-dl-1 py-dl-1 text-center text-dl-4 font-dl-3 text-white shadow-sm transition-all duration-200 ease-in-out hover:bg-dl-grey-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dl-pink-6"
            (click)="viewShoppingList()"
          >
            View Shopping List
          </button>
          <p
            *ngIf="shoppingList?.ingredients?.length === 0 && displayUsageDate !== 'Today'"
            class="ml-dl-4 text-dl-4 italic text-dl-teal-7"
          >
            Current inventory is sufficient!
          </p>
        </div>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="mx-dl-5 mt-dl-5 flex flex-col rounded-lg pb-dl-5 shadow-md">
      <div class="flex justify-between">
        <p class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-6 font-dl-3 text-dl-grey-2">
          Ingredients
        </p>
        <button
          id="edit-recipe-ingredients-button"
          type="button"
          class="mr-dl-7 block h-dl-4 w-dl-6 whitespace-nowrap rounded-dl-1 border border-dl-pink-4 bg-white px-dl-1 py-dl-1 text-center text-dl-4 font-dl-3 text-dl-pink-4 shadow-sm transition-all duration-200 ease-in-out hover:bg-dl-grey-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dl-pink-6"
          (click)="editReciptIngredients()"
        >
          Edit
        </button>
      </div>
      <div
        *ngFor="let ingredient of displayIngredients$ | async"
        class="mt-dl-2 flex"
      >
        <span class="pl-dl-3 text-dl-5 font-dl-2 text-dl-grey-3">
          {{ ingredient.name }}
        </span>
        <span class="ml-dl-3 text-dl-5 font-dl-2 text-dl-grey-3">
          {{ ingredient.measurement }} {{ ingredient.measurementUnit }}
        </span>
      </div>
    </div>

    <!-- Tools -->
    <div
      *ngIf="displayTools$ | async"
      class="mx-dl-5 mt-dl-5 flex flex-col rounded-lg pb-dl-5 shadow-md"
    >
      <div class="flex justify-between">
        <p class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-6 font-dl-3 text-dl-grey-2">
          Tools
        </p>
        <button
          id="edit-recipe-tools-button"
          type="button"
          class="mr-dl-7 block h-dl-4 w-dl-6 whitespace-nowrap rounded-dl-1 border border-dl-pink-4 bg-white px-dl-1 py-dl-1 text-center text-dl-4 font-dl-3 text-dl-pink-4 shadow-sm transition-all duration-200 ease-in-out hover:bg-dl-grey-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dl-pink-6"
          (click)="editRecipeTools()"
        >
          Edit
        </button>
      </div>
      <div *ngFor="let tool of displayTools$ | async" class="mt-dl-2 flex">
        <span class="pl-dl-3 text-dl-5 font-dl-2 text-dl-grey-3">
          {{ tool.name }}
        </span>
        <span
          *ngIf="tool.quantity > 0"
          class="ml-dl-3 text-dl-5 font-dl-2 text-dl-blue-3"
        >
          {{ tool.quantity }}
        </span>
      </div>
    </div>

    <!-- Steps -->
    <div
      *ngIf="displayStepsWithPhoto$ | async"
      class="mx-dl-5 mt-dl-5 flex flex-col items-center rounded-lg pb-dl-5 shadow-md"
    >
      <div class="mb-dl-6 flex w-full justify-between">
        <p class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-6 font-dl-3 text-dl-grey-2">
          Steps
        </p>
        <button
          id="edit-recipe-tools-button"
          type="button"
          class="mr-dl-7 block h-dl-4 w-dl-6 whitespace-nowrap rounded-dl-1 border border-dl-pink-4 bg-white px-dl-1 text-center text-dl-4 font-dl-3 text-dl-pink-4 shadow-sm transition-all duration-200 ease-in-out hover:bg-dl-grey-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dl-pink-6"
          (click)="editRecipeSteps()"
        >
          Edit
        </button>
      </div>
      <div
        *ngFor="let step of displayStepsWithPhoto$ | async; let i = index"
        class="mb-dl-7 flex w-full flex-col items-center justify-center"
      >
        <div class="mb-dl-2 flex w-full items-start">
          <!-- Step number with consistent width and padding -->
          <div class="ml-dl-3 mr-dl-1 w-dl-4 px-dl-3 text-dl-5 text-dl-grey-2">
            {{ i + 1 }}.
          </div>
          <!-- Description taking the remaining width -->
          <div class="flex-1">
            <p
              class="mr-dl-6 whitespace-normal text-dl-5 font-dl-2 text-dl-grey-2"
            >
              {{ step.description }}
            </p>
          </div>
        </div>
        <!-- Step photo -->
        <img
          *ngIf="step.photo"
          [src]="step.photo"
          class="mt-dl-2 w-4/5 object-cover"
        />
      </div>
    </div>
  </div>
</div>
