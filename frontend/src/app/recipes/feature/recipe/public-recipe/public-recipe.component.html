<div class="relative flex w-full flex-col items-center dark:bg-dl-grey-1">
  <mat-spinner class="my-app-custom-spinner" *ngIf="!ready()"></mat-spinner>
  <div
    *ngIf="ready()"
    [ngClass]="{
      'blur-sm': onboardingModalOpen()
    }"
  >
    <img
      *ngIf="recipe().photoURL"
      [src]="recipe().photoURL"
      alt="Recipe Image"
      class="w-full object-cover"
    />
    <!-- Overview -->
    <div
      class="relative mx-dl-5 mb-dl-5 mt-dl-3 rounded-lg shadow-md dark:bg-dl-grey-2"
    >
      <div class="mx-dl-5 mb-dl-4 mt-dl-5 flex justify-between">
        <h1
          class="text-dl-7 font-dl-3 leading-dl-2 text-dl-grey-1 dark:text-dl-grey-10"
        >
          {{ recipe().title }}
        </h1>
        <div class="" *ngIf="author()">
          <img
            *ngIf="author().imageURL"
            (click)="onFriendClick(author())"
            class="h-dl-5 w-dl-5 rounded-full"
            [src]="author().imageURL"
            alt="author profile image"
          />
          <span
            class="inline-flex h-dl-5 w-dl-5 items-center justify-center rounded-full bg-dl-grey-9 dark:bg-dl-grey-3"
            *ngIf="
              !author().imageURL && author().nameFirst && author().nameLast
            "
          >
            <span
              class="text-dl-6 font-dl-3 leading-none text-dl-grey-7 dark:text-dl-grey-4"
              >{{ initials() }}</span
            >
          </span>
        </div>
      </div>
      <!-- Category, Servings , Subscriber Count-->
      <div class="mx-dl-5 mb-dl-5 flex items-center justify-between">
        <p
          class="ml-dl-1 text-dl-6 font-dl-2 leading-dl-2 text-dl-grey-2 dark:text-dl-grey-9"
        >
          {{ recipeCategory()?.name }}
        </p>
        <div class="flex pt-dl-2">
          <!--Servings-->
          <div class="relative flex">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              version="1.1"
              height="35"
              width="35"
              viewBox="0 0 90 112.5"
              style="enable-background: new 0 0 90 90"
              xml:space="preserve"
            >
              <path
                [attr.fill]="'hsl(209, 14%, 37%)'"
                d="M87.4,14.5c0,0,1.6-1.8,0.9-2.5s-2.5,0.9-2.5,0.9S75.6,21.5,74,23.1l0,0c0,0-1.2,1.2-2.1,0.2c-1-1,0.2-2.1,0.2-2.1  c1.7-1.7,10.3-11.7,10.3-11.7S84,7.7,83.2,7c-0.7-0.7-2.5,0.9-2.5,0.9S70.7,16.5,69,18.1c0,0-1.2,1.2-2.1,0.2c-1-1,0.2-2.1,0.2-2.1  c1.7-1.7,10.3-11.7,10.3-11.7S79,2.7,78.3,2s-2.5,0.9-2.5,0.9S65.7,11.5,64,13.1c0,0-1.9,1.9-3.9,3.9l0,0L57,20.1  c-3,3-4.3,6.8-3.9,10.1c0,0,0,0,0,0c0.2,2.8-1.5,4.6-1.5,4.6L3,80.7c-0.1,0.1-0.2,0.2-0.3,0.3c-2.2,2.2-2.6,5.5-0.8,7.3  c1.8,1.8,5.1,1.5,7.3-0.8c0.1-0.1,0.2-0.2,0.3-0.3l45.8-48.6c0,0,1.8-1.8,4.6-1.6c0.1,0,0.2,0,0.3,0c3.2,0.3,6.9-1,9.8-3.9l2.8-2.8  l0.3-0.3c1.9-1.9,3.9-3.9,3.9-3.9C78.7,24.5,87.4,14.5,87.4,14.5z"
              />
            </svg>
            <span
              class="ml-dl-1 text-dl-6 font-dl-2 leading-dl-2 text-dl-grey-4 dark:text-dl-grey-9"
              >{{ recipe().servings }}</span
            >
          </div>
          <!--Subscriber Count-->
          <div class="ml-dl-5 mr-dl-2 flex">
            <svg
              height="512"
              viewBox="0 0 24 24"
              width="512"
              xmlns="http://www.w3.org/2000/svg"
              id="fi_2118701"
              height="32"
              width="32"
              class=""
            >
              <path
                [attr.fill]="'hsl(209, 14%, 37%)'"
                d="m23 19a1 1 0 0 1 -1 1h-12a1 1 0 0 1 -1-1 6 6 0 0 1 6-6h2a6 6 0 0 1 6 6zm-7-15a4 4 0 1 0 4 4 4 4 0 0 0 -4-4zm-9 0a4 4 0 1 0 4 4 4 4 0 0 0 -4-4zm0 15a7.94 7.94 0 0 1 2.35-5.65 5.43 5.43 0 0 0 -1.91-.35h-.88a5.57 5.57 0 0 0 -5.56 5.56v.44a1 1 0 0 0 1 1h5.18a3 3 0 0 1 -.18-1z"
              ></path>
            </svg>
            <span
              class="ml-dl-1 text-dl-6 font-dl-2 leading-dl-2 text-dl-grey-4 dark:text-dl-grey-9"
              >{{ subscriptions().length }}</span
            >
          </div>
        </div>
      </div>

      <!--Times -->
      <div
        class="mx-dl-2 mt-dl-2 flex flex-wrap items-center px-dl-1 pb-dl-5 pt-dl-1"
      >
        <div class="mb-dl-3 flex items-center pr-dl-4">
          <svg
            class="text-dl-grey-4"
            width="22"
            height="22"
            viewBox="0 0 15 15"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M7.50009 0.877014C3.84241 0.877014 0.877258 3.84216 0.877258 7.49984C0.877258 11.1575 3.8424 14.1227 7.50009 14.1227C11.1578 14.1227 14.1229 11.1575 14.1229 7.49984C14.1229 3.84216 11.1577 0.877014 7.50009 0.877014ZM1.82726 7.49984C1.82726 4.36683 4.36708 1.82701 7.50009 1.82701C10.6331 1.82701 13.1729 4.36683 13.1729 7.49984C13.1729 10.6328 10.6331 13.1727 7.50009 13.1727C4.36708 13.1727 1.82726 10.6328 1.82726 7.49984ZM8 4.50001C8 4.22387 7.77614 4.00001 7.5 4.00001C7.22386 4.00001 7 4.22387 7 4.50001V7.50001C7 7.63262 7.05268 7.7598 7.14645 7.85357L9.14645 9.85357C9.34171 10.0488 9.65829 10.0488 9.85355 9.85357C10.0488 9.65831 10.0488 9.34172 9.85355 9.14646L8 7.29291V4.50001Z"
              fill="currentColor"
              fill-rule="evenodd"
              clip-rule="evenodd"
            ></path>
          </svg>
          <p
            *ngIf="recipe().timePrep"
            class="ml-dl-2 text-dl-5 font-dl-2 text-dl-grey-4 dark:text-dl-grey-9"
          >
            Prep: {{ timeString(recipe().timePrep) }}
          </p>
        </div>
        <p
          *ngIf="recipe().timeBake"
          class="mb-dl-3 text-dl-5 font-dl-2 text-dl-grey-4 dark:text-dl-grey-9"
        >
          Bake: {{ timeString(recipe().timeBake) }}
        </p>
        <p
          *ngIf="recipe().timeBake"
          class="mb-dl-3 pl-dl-4 text-dl-5 font-dl-3 text-dl-grey-3 dark:text-dl-grey-10"
        >
          Total:
          {{ timeString(recipe().timeBake + recipe().timePrep) }}
        </p>
      </div>

      <!-- Subscribe Section -->
      <div
        *ngIf="recipeSubscription()"
        class="mx-dl-5 mb-dl-5 flex items-center justify-between px-dl-1 pb-dl-5 pt-dl-1"
      >
        <p class="text-dl-5 font-dl-2 text-dl-grey-4 dark:text-dl-grey-7">
          You are subscribed
        </p>
        <button
          type="button"
          class="block w-dl-9 whitespace-nowrap rounded-dl-1 border bg-dl-pink-4 px-dl-1 py-dl-1 text-center text-dl-5 font-dl-3 text-white shadow-sm transition-all duration-200 ease-in-out dark:border-dl-grey-2 dark:bg-dl-pink-7 dark:text-dl-grey-1"
          (click)="onSubscribeClick()"
        >
          My Subscription
        </button>
      </div>

      <div
        *ngIf="!recipeSubscription()"
        class="mx-dl-5 mb-dl-5 flex items-center justify-between px-dl-1 pb-dl-5 pt-dl-1"
      >
        <p class="text-dl-5 font-dl-2 text-dl-grey-4 dark:text-dl-grey-9">
          Subscribe to use this recipe
        </p>
        <button
          type="button"
          class="block whitespace-nowrap rounded-dl-1 border bg-dl-pink-4 px-dl-3 py-dl-1 text-center text-dl-5 font-dl-3 text-white shadow-sm !blur-none transition-all duration-200 ease-in-out dark:border-dl-grey-2 dark:bg-dl-pink-7 dark:text-dl-grey-1"
          (click)="onSubscribeClick()"
        >
          Subscribe
        </button>
      </div>
    </div>

    <!-- Ingredients -->
    <div
      *ngIf="displayIngredientsByComponent()"
      class="mx-dl-5 mt-dl-5 flex flex-col rounded-lg pb-dl-5 shadow-md dark:bg-dl-grey-2"
    >
      <div class="flex justify-between">
        <p
          class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-7 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
        >
          Ingredients
        </p>
      </div>
      <!-- Base Ingredients (no assigned component) -->
      <div
        *ngFor="let ingredient of displayIngredientsByComponent().noComponent"
        class="mt-dl-2 flex w-full justify-between"
      >
        <span
          class="min-w-dl-9 pl-dl-5 text-dl-6 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
        >
          {{ ingredient.name }}
          <span
            *ngIf="ingredient.preparation"
            class="pl-dl-3 text-dl-5 font-dl-2 italic text-dl-grey-2 dark:text-dl-grey-9"
          >
            {{ ingredient.preparation }}
          </span>
        </span>
        <div class="flex justify-end">
          <span
            class="ml-dl-1 mr-dl-3 text-dl-6 font-dl-2 text-dl-grey-3 dark:text-dl-grey-10"
          >
            {{ ingredient.measurement }}
          </span>
          <span
            class="min-w-dl-8 text-dl-6 font-dl-2 text-dl-grey-2 dark:text-dl-grey-9"
          >
            {{
              ingredient.measurementUnit === "weightOunces"
                ? "oz"
                : ingredient.measurementUnit
            }}
          </span>
        </div>
      </div>

      <!-- Ingredients for recipe components (ex: filling, sauce) -->
      <div
        *ngFor="
          let component of displayIngredientsByComponent().components | keyvalue
        "
        class="relative mt-dl-7"
      >
        <div>
          <!-- Italic Label with component name -->
          <span
            class="absolute -top-4 left-1/2 -translate-x-1/2 text-dl-6 font-dl-3 italic text-dl-grey-5 dark:text-dl-grey-8"
            >for {{ component.key }}</span
          >

          <!-- Ingredients for component (display them same as in no-component) -->
          <div
            *ngFor="let ingredient of component.value"
            class="mt-dl-2 flex w-full justify-between"
          >
            <span
              class="min-w-dl-9 pl-dl-5 text-dl-6 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
            >
              {{ ingredient.name }}
              <span
                *ngIf="ingredient.preparation"
                class="pl-dl-3 text-dl-5 font-dl-2 italic text-dl-grey-2 dark:text-dl-grey-9"
              >
                {{ ingredient.preparation }}
              </span>
            </span>
            <div class="flex justify-end">
              <span
                class="ml-dl-1 mr-dl-3 text-dl-6 font-dl-2 text-dl-grey-3 dark:text-dl-grey-10"
              >
                {{ ingredient.measurement }}
              </span>
              <span
                class="min-w-dl-8 text-dl-6 font-dl-2 text-dl-grey-2 dark:text-dl-grey-9"
              >
                {{
                  ingredient.measurementUnit === "weightOunces"
                    ? "oz"
                    : ingredient.measurementUnit
                }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tools -->
    <div
      class="mx-dl-5 mt-dl-5 flex flex-col rounded-lg pb-dl-5 shadow-md dark:bg-dl-grey-2"
    >
      <div class="flex items-center justify-between">
        <p
          class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-7 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
        >
          Tools
        </p>
      </div>
      <div
        *ngFor="let tool of tools()"
        class="mt-dl-2 flex w-full justify-between"
      >
        <span
          class="min-w-dl-9 pl-dl-5 text-dl-6 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
        >
          {{ tool.name }}
        </span>
        <span
          *ngIf="tool.quantity > 0"
          class="mr-dl-7 text-dl-6 font-dl-2 text-dl-grey-3 dark:text-dl-grey-9"
        >
          {{ tool.quantity }}
        </span>
      </div>
      <span
        *ngIf="!tools().length || tools()[0].quantity === -1"
        class="pl-dl-5 text-dl-6 font-dl-2 italic text-dl-grey-3 dark:text-dl-grey-9"
      >
        None required
      </span>
    </div>

    <!-- Steps -->
    <div
      class="mx-dl-5 mb-dl-2 mt-dl-5 flex flex-col items-center rounded-lg pb-dl-5 shadow-md dark:bg-dl-grey-2"
    >
      <div class="mb-dl-4 flex w-full justify-between">
        <p
          class="mb-dl-3 pl-dl-3 pt-dl-1 text-dl-7 font-dl-3 text-dl-grey-2 dark:text-dl-grey-10"
        >
          Steps
        </p>
      </div>
      <div
        *ngFor="let step of displaySteps(); let i = index"
        class="flex w-full flex-col items-center justify-center"
        [ngClass]="{
          'mb-dl-6': i !== steps().length - 1,
        }"
      >
        <div class="mb-dl-2 flex w-full items-start">
          <!-- Step number with consistent width and padding -->
          <div
            class="pl-dl-5 text-dl-6 font-dl-3 text-dl-grey-3 dark:text-dl-grey-8"
          >
            {{ i + 1 }})
          </div>
          <!-- Title taking the remaining width -->
          <div class="flex-1">
            <p
              class="ml-dl-2 mr-dl-6 overflow-hidden whitespace-normal text-dl-6 font-dl-3 italic text-dl-grey-3 dark:text-dl-grey-10"
            >
              {{ step.title }}
            </p>
          </div>
        </div>
        <!-- Step Description -->
        <p
          class="my-dl-1 w-full px-dl-5 text-left text-dl-5 font-dl-2 text-dl-grey-4 dark:text-dl-grey-9"
          style="text-indent: 20px; text-align: justify"
        >
          {{ step.description }}
        </p>
        <!-- Step photo -->
        <img
          *ngIf="step.photoURL"
          [src]="step.photoURL"
          class="mt-dl-2 w-4/5 object-cover"
        />
      </div>
    </div>
  </div>
  <div
    *ngIf="showOnboardingBadge()"
    (click)="onboardingBadgeClick()"
    class="fixed bottom-24 left-4 flex h-dl-5 w-dl-5 flex-col items-center rounded-full bg-dl-blue-9 dark:bg-dl-blue-2"
  >
    <svg
      class="h-11 w-8 text-dl-blue-7 dark:text-dl-blue-4"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      version="1.1"
      x="0px"
      y="0px"
      viewBox="6 5 50 50"
      style="enable-background: new 0 0 64 64"
      xml:space="preserve"
    >
      <g>
        <g>
          <path
            [attr.fill]="'hsl(203, 87%, 34%)'"
            d="M25.76,46.15c-0.4,0-0.8-0.05-1.2-0.18c-1.59-0.52-2.56-2.02-3.41-3.34c-0.58-0.89-1.12-1.73-1.76-2.19    c-0.65-0.47-1.63-0.74-2.66-1.01c-1.59-0.43-3.23-0.87-4.2-2.2c-0.96-1.32-0.87-3.01-0.79-4.64c0.05-1.08,0.11-2.1-0.15-2.88    c-0.24-0.73-0.86-1.49-1.52-2.3c-1-1.23-2.14-2.63-2.14-4.33c0-1.7,1.14-3.1,2.14-4.33c0.66-0.81,1.28-1.58,1.52-2.3    c0.25-0.78,0.2-1.8,0.15-2.88c-0.08-1.63-0.17-3.32,0.79-4.64c0.97-1.33,2.61-1.77,4.2-2.2c1.04-0.28,2.01-0.54,2.66-1.01    c0.64-0.46,1.18-1.3,1.76-2.19C22,2.2,22.98,0.7,24.56,0.18c1.52-0.49,3.09,0.1,4.6,0.68c0.98,0.37,1.99,0.76,2.84,0.76    c0.85,0,1.86-0.39,2.84-0.76c1.51-0.58,3.07-1.17,4.6-0.68C41.02,0.7,42,2.2,42.85,3.53c0.57,0.89,1.12,1.73,1.76,2.19    c0.65,0.47,1.63,0.73,2.66,1.01c1.59,0.43,3.23,0.87,4.2,2.19c0.96,1.32,0.87,3.01,0.79,4.64c-0.05,1.08-0.11,2.1,0.15,2.88    c0.24,0.73,0.86,1.49,1.52,2.3c1,1.23,2.14,2.63,2.14,4.33c0,1.7-1.14,3.1-2.14,4.33c-0.66,0.81-1.28,1.58-1.52,2.3    c-0.25,0.78-0.2,1.8-0.15,2.88c0.08,1.63,0.17,3.32-0.79,4.64c-0.97,1.33-2.61,1.77-4.2,2.19c-1.04,0.28-2.01,0.54-2.66,1.01    c-0.64,0.46-1.18,1.3-1.76,2.19c-0.86,1.33-1.83,2.83-3.41,3.34c-1.52,0.49-3.08-0.1-4.6-0.68c-0.98-0.37-1.99-0.76-2.84-0.76    c-0.85,0-1.86,0.39-2.84,0.76C28.04,45.71,26.9,46.15,25.76,46.15z M25.76,1.94c-0.21,0-0.41,0.03-0.6,0.09    c-0.93,0.3-1.64,1.39-2.38,2.55c-0.65,1-1.32,2.03-2.24,2.71c-0.94,0.68-2.14,1.01-3.3,1.32c-1.32,0.35-2.57,0.69-3.13,1.46    c-0.55,0.76-0.49,2.04-0.42,3.4c0.06,1.21,0.12,2.46-0.24,3.58c-0.35,1.07-1.12,2.01-1.86,2.93c-0.88,1.08-1.71,2.1-1.71,3.1    c0,1.01,0.83,2.03,1.71,3.1c0.74,0.91,1.51,1.86,1.86,2.93c0.36,1.12,0.3,2.37,0.24,3.57c-0.07,1.36-0.13,2.64,0.42,3.4    c0.56,0.78,1.81,1.11,3.13,1.46c1.16,0.31,2.36,0.63,3.3,1.32c0.93,0.68,1.6,1.71,2.24,2.71c0.75,1.16,1.45,2.25,2.38,2.55    c0.87,0.28,2.05-0.17,3.31-0.65c1.14-0.44,2.33-0.89,3.53-0.89c1.2,0,2.39,0.45,3.53,0.89c1.25,0.48,2.44,0.93,3.31,0.65    c0.93-0.3,1.64-1.39,2.38-2.55c0.65-1,1.32-2.03,2.24-2.71c0.94-0.68,2.14-1.01,3.3-1.32c1.32-0.35,2.57-0.69,3.13-1.46    c0.55-0.76,0.49-2.04,0.42-3.4c-0.06-1.21-0.12-2.46,0.24-3.58c0.35-1.07,1.12-2.02,1.86-2.93c0.88-1.08,1.71-2.1,1.71-3.1    c0-1.01-0.83-2.03-1.71-3.1c-0.74-0.91-1.51-1.86-1.86-2.93c-0.36-1.12-0.3-2.37-0.24-3.57c0.07-1.36,0.13-2.64-0.42-3.4    c-0.56-0.77-1.81-1.11-3.13-1.46c-1.16-0.31-2.36-0.63-3.3-1.32c-0.93-0.68-1.6-1.71-2.24-2.71c-0.75-1.16-1.45-2.25-2.39-2.55    c-0.87-0.28-2.05,0.17-3.31,0.65C34.39,3.11,33.2,3.57,32,3.57c-1.2,0-2.39-0.45-3.53-0.89C27.48,2.3,26.54,1.94,25.76,1.94z"
          />
        </g>
        <g>
          <g>
            <path
              [attr.fill]="'hsl(203, 87%, 34%)'"
              d="M32,38.07c-8.27,0-14.99-6.72-14.99-14.99S23.73,8.08,32,8.08c8.27,0,14.99,6.72,14.99,14.99S40.27,38.07,32,38.07z      M32,10.02c-7.2,0-13.05,5.85-13.05,13.05S24.8,36.13,32,36.13c7.2,0,13.05-5.86,13.05-13.05S39.2,10.02,32,10.02z"
            />
          </g>
          <g>
            <path
              [attr.fill]="'hsl(203, 87%, 34%)'"
              d="M30.42,27.8c-0.26,0-0.5-0.1-0.69-0.28l-3.7-3.7c-0.38-0.38-0.38-0.99,0-1.37c0.38-0.38,0.99-0.38,1.37,0l3.01,3.01     l6.82-6.82c0.38-0.38,0.99-0.38,1.37,0c0.38,0.38,0.38,0.99,0,1.37l-7.51,7.51C30.93,27.7,30.68,27.8,30.42,27.8z"
            />
          </g>
        </g>
        <g>
          <path
            [attr.fill]="'hsl(203, 87%, 34%)'"
            d="M42.36,64c-0.19,0-0.39-0.06-0.55-0.17L32,57.04l-9.81,6.79c-0.3,0.2-0.68,0.23-1,0.06c-0.32-0.17-0.52-0.5-0.52-0.86    V41.61c0-0.54,0.43-0.97,0.97-0.97c0.54,0,0.97,0.43,0.97,0.97v19.57l8.84-6.12c0.33-0.23,0.77-0.23,1.1,0l8.84,6.12V41.61    c0-0.54,0.43-0.97,0.97-0.97s0.97,0.43,0.97,0.97v21.42c0,0.36-0.2,0.69-0.52,0.86C42.67,63.96,42.52,64,42.36,64z"
          />
        </g>
      </g>
    </svg>
  </div>
</div>
