<div class="flex h-full w-full flex-col px-dl-4 pt-dl-4">
  <!-- Heading ('Shopping' or 'Draft')-->
  <div class="relative mb-dl-3 flex w-full flex-row-reverse justify-between">
    <span
      class="inline-flex items-center border-b-4 border-dl-blue-8 text-dl-7 font-dl-3 text-dl-grey-2 transition-all duration-100 ease-in-out"
      >Draft List</span
    >
    <svg
      width="40"
      height="40"
      viewBox="0 0 15 15"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      (click)="toggleMenu($event)"
      [ngClass]="{
        invisible: !displayRecipes().length && !displaySLStandaloneIngr().length
      }"
    >
      <path
        d="M3.625 7.5C3.625 8.12132 3.12132 8.625 2.5 8.625C1.87868 8.625 1.375 8.12132 1.375 7.5C1.375 6.87868 1.87868 6.375 2.5 6.375C3.12132 6.375 3.625 6.87868 3.625 7.5ZM8.625 7.5C8.625 8.12132 8.12132 8.625 7.5 8.625C6.87868 8.625 6.375 8.12132 6.375 7.5C6.375 6.87868 6.87868 6.375 7.5 6.375C8.12132 6.375 8.625 6.87868 8.625 7.5ZM12.5 8.625C13.1213 8.625 13.625 8.12132 13.625 7.5C13.625 6.87868 13.1213 6.375 12.5 6.375C11.8787 6.375 11.375 6.87868 11.375 7.5C11.375 8.12132 11.8787 8.625 12.5 8.625Z"
        fill="currentColor"
        fill-rule="evenodd"
        clip-rule="evenodd"
      ></path>
    </svg>
    <div
      #menu
      *ngIf="menuOpen"
      class="focus:outling-none absolute left-16 top-2 z-10 flex flex-col rounded-dl-1 bg-white shadow-md ring-1 ring-dl-grey-1 ring-opacity-5 ease-out"
    >
      <button
        (click)="onDeleteClick()"
        type="button"
        class="block cursor-pointer px-dl-3 py-dl-2 text-dl-5 text-dl-grey-3 hover:bg-dl-grey-10"
      >
        Clear All
      </button>
    </div>
  </div>
  <div
    *ngIf="isDeleting()"
    class="flex h-full w-full items-center justify-center"
  >
    <mat-spinner class="my-app-custom-spinner"></mat-spinner>
  </div>
  <div
    *ngIf="!isDeleting()"
    class="flex w-full flex-grow flex-col items-center overflow-y-auto"
  >
    <!-- recipes/ingredients columns-->
    <div class="flex w-full flex-grow flex-col items-center overflow-y-auto">
      <!-- ShoppingListRecipes -->
      <p class="mb-dl-1 text-dl-6 font-dl-3 text-dl-grey-2">Planned Recipes</p>
      <div
        class="relative mb-dl-2 flex max-h-dl-10 flex-col items-center overflow-y-auto"
      >
        <div class="flex flex-col items-center">
          <dl-recipe-card
            *ngFor="let recipe of displayRecipes()"
            (click)="recipeCardClick(recipe)"
            [recipe]="recipe"
            [fromMyRecipes]="true"
            [isSelected]="recipe.shoppingListRecipeID === selectedRecipeID()"
            [shoppingPage]="true"
          ></dl-recipe-card>
        </div>
      </div>
      <button
        type="button"
        class="mb-dl-3 block h-dl-5 w-full whitespace-nowrap rounded-dl-1 border-2 px-dl-1 py-dl-1 text-center text-dl-5 font-dl-3"
        [ngClass]="{
          'bg-dl-pink-4 text-white': selectedRecipeID() === 0,
          'border-dl-pink-4 bg-white text-dl-pink-4': selectedRecipeID() !== 0,
          invisible:
            recipes().length - displayRecipes().length === 0 &&
            selectedRecipeID() === 0
        }"
        (click)="onRecipeButtonClick()"
      >
        @if (selectedRecipeID() === 0) { Add Recipe } @else { Remove Recipe and
        Related Items }
      </button>

      <!-- ShoppingListIngredients -->
      <p class="mb-dl-1 mt-dl-3 w-full text-dl-6 font-dl-3 text-dl-grey-2">
        Items to Buy
      </p>
      <div
        class="relative mb-dl-4 flex w-full flex-grow flex-col overflow-y-auto border-dl-grey-2 bg-dl-grey-10 px-dl-3 py-dl-2"
      >
        <!-- Planned Recipe Items -->
        <p class="mb-dl-2 ml-dl-2 text-dl-5 font-dl-3 text-dl-pink-6">
          Planned Recipe Items
        </p>
        <div class="flex flex-grow flex-wrap overflow-y-auto rounded-dl-3">
          @for (item of displaySLRecipeIngr(); track item.ingredientName) {
          <div
            class="relative mx-dl-2 mb-dl-2 flex max-h-dl-4 justify-between rounded-dl-1 bg-white px-dl-1 py-dl-1"
          >
            <span class="text-dl-5 font-dl-3 text-dl-grey-1">
              {{ item.ingredientName }}
              <span class="text-dl-5 font-dl-2 text-dl-grey-3">
                {{ Math.ceil(item.quantity) }} {{ item.unit }}
              </span>
            </span>
          </div>
          } @empty {
          <p class="pl-dl-3 text-dl-4 font-dl-2 italic text-dl-grey-5">None</p>
          }
        </div>

        <!-- Standalone Items -->
        <p class="mb-dl-2 ml-dl-2 mt-dl-3 text-dl-5 font-dl-3 text-dl-pink-6">
          Other Items
        </p>
        <div
          class="min-h-dl-8 flex flex-grow flex-wrap overflow-y-auto rounded-dl-3"
        >
          @for (item of displaySLStandaloneIngr(); track item.ingredientID) {
          <div
            (click)="standaloneIngredientCardClick(item)"
            class="relative mx-dl-2 mb-dl-2 flex max-h-dl-4 justify-between rounded-dl-1 border border-dl-grey-5 px-dl-1 py-dl-1 transition-all duration-200 ease-in-out"
            [ngClass]="{
              'border-dl-grey-8 bg-white':
                item.shoppingListIngredientID !== selectedSLIngrID(),
              'border-dl-teal-8 bg-dl-teal-10':
                item.shoppingListIngredientID === selectedSLIngrID()
            }"
          >
            <span class="text-dl-5 font-dl-3 text-dl-grey-1">
              {{ item.name }}
              <span class="text-dl-5 font-dl-2 text-dl-grey-3">
                {{ Math.ceil(item.needMeasurement) }} {{ item.needUnit }}
              </span>
            </span>
          </div>
          } @empty {
          <p class="pl-dl-3 text-dl-4 font-dl-2 italic text-dl-grey-5">None</p>
          }
        </div>
      </div>
    </div>
    <button
      type="button"
      class="mb-dl-3 block h-dl-5 w-full whitespace-nowrap rounded-dl-1 border-2 px-dl-1 py-dl-1 text-center text-dl-5 font-dl-3"
      (click)="onItemButtonClick()"
      [ngClass]="{
      'bg-dl-pink-4 text-white': selectedSLIngrID() === 0,
      'border-dl-pink-4 bg-white text-dl-pink-4': selectedSLIngrID() !== 0,
    }"
    >
      @if (selectedSLIngrID() === 0) { Add Other Item } @else { Remove Selected
      Item }
    </button>

    <!-- Done Adding, Shop button-->
    <button
      type="button"
      *ngIf="isLoading() === false"
      class="mb-dl-2 block h-dl-5 w-full whitespace-nowrap rounded-dl-1 border px-dl-1 py-dl-1 text-center text-dl-5 font-dl-3 text-white shadow-lg transition-all duration-200 ease-in-out"
      (click)="onShopClick()"
      [ngClass]="{
        'bg-dl-grey-7 ':
          displaySLRecipeIngr().length === 0 &&
          displaySLStandaloneIngr().length === 0,
        'bg-dl-pink-4 ':
          displaySLRecipeIngr().length !== 0 ||
          displaySLStandaloneIngr().length !== 0
      }"
      [disabled]="
        displaySLRecipeIngr().length === 0 &&
        displaySLStandaloneIngr().length === 0
      "
    >
      Confirm and Go Shopping
    </button>
    <div
      *ngIf="isLoading() === true"
      class="flex h-full w-full items-center justify-center"
    >
      <mat-spinner class="my-app-custom-spinner"></mat-spinner>
    </div>
  </div>
</div>
